# ~/.shell_common
# Shared configuration for both bash and zsh
# Source this file from both ~/.bashrc and ~/.zshrc

# ============================================
# Environment Variables
# ============================================

# Add local bin to PATH
export PATH="$HOME/.local/bin:$PATH"

# Default editor
export EDITOR="nano"
export VISUAL="nano"

# Python settings
export PYTHONUNBUFFERED=1

# ============================================
# Aliases - General
# ============================================

# List directory contents
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Navigation shortcuts
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias projects='cd ~/projects'

# File operations
alias cp='cp -i'
alias mv='mv -i'
alias rm='rm -i'

# Open in Windows Explorer
alias open='explorer.exe .'

# ============================================
# Aliases - Git
# ============================================

alias gs='git status'
alias ga='git add'
alias gaa='git add .'
alias gc='git commit -m'
alias gca='git commit --amend'
alias gp='git push'
alias gpl='git pull'
alias gl='git log --oneline --graph --decorate'
alias gco='git checkout'
alias gb='git branch'
alias gd='git diff'

# ============================================
# Aliases - Python & Development
# ============================================

alias py='python3'
alias pip='python3 -m pip'

# Virtual environment
alias venv='python3 -m venv .venv'
alias activate='source .venv/bin/activate'
alias deactivate='deactivate'

# uv package manager
alias upi='uv pip install'
alias upup='uv pip install --upgrade'
alias upl='uv pip list'

# Testing
alias pytest='python3 -m pytest'
alias test='python3 -m pytest -v'

# Formatting and linting
alias format='ruff format .'
alias lint='ruff check .'
alias fix='ruff check --fix .'

# ============================================
# Aliases - Docker
# ============================================

alias d='docker'
alias dc='docker compose'
alias dps='docker ps'
alias dpsa='docker ps -a'
alias di='docker images'
alias drm='docker rm'
alias drmi='docker rmi'
alias dstop='docker stop $(docker ps -q)'
alias dclean='docker system prune -af'

# Docker Compose
alias dcup='docker compose up -d'
alias dcdown='docker compose down'
alias dclogs='docker compose logs -f'
alias dcrestart='docker compose restart'

# ============================================
# Aliases - System
# ============================================

# Update system
alias update='sudo apt update && sudo apt upgrade -y'

# Disk usage
alias du='du -h'
alias df='df -h'

# Process management
alias psg='ps aux | grep -v grep | grep -i -e VSZ -e'

# Network
alias myip='curl -s ifconfig.me'
alias ports='netstat -tulanp'

# ============================================
# Functions
# ============================================

# Create directory and cd into it
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Extract archives
extract() {
  if [ -f "$1" ]; then
    case "$1" in
      *.tar.bz2)   tar xjf "$1"     ;;
      *.tar.gz)    tar xzf "$1"     ;;
      *.bz2)       bunzip2 "$1"     ;;
      *.rar)       unrar x "$1"     ;;
      *.gz)        gunzip "$1"      ;;
      *.tar)       tar xf "$1"      ;;
      *.tbz2)      tar xjf "$1"     ;;
      *.tgz)       tar xzf "$1"     ;;
      *.zip)       unzip "$1"       ;;
      *.Z)         uncompress "$1"  ;;
      *.7z)        7z x "$1"        ;;
      *)           echo "'$1' cannot be extracted via extract()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# Find file by name
ff() {
  find . -type f -iname "*$1*"
}

# Find directory by name
fd() {
  find . -type d -iname "*$1*"
}

# Quick search in files
search() {
  grep -r "$1" .
}

# Start services
start_services() {
  echo "ðŸš€ Starting services..."
  sudo service docker start > /dev/null 2>&1 && echo "âœ… Docker started"
  sudo service postgresql start > /dev/null 2>&1 && echo "âœ… PostgreSQL started"
}

# Stop services
stop_services() {
  echo "â¹ï¸  Stopping services..."
  sudo service docker stop > /dev/null 2>&1 && echo "âœ… Docker stopped"
  sudo service postgresql stop > /dev/null 2>&1 && echo "âœ… PostgreSQL stopped"
}

# Status of services
status_services() {
  echo "ðŸ“Š Service Status:"
  sudo service docker status 2>&1 | grep -q "running" && echo "âœ… Docker: Running" || echo "âŒ Docker: Stopped"
  sudo service postgresql status 2>&1 | grep -q "online" && echo "âœ… PostgreSQL: Running" || echo "âŒ PostgreSQL: Stopped"
}

# Auto-start services on shell initialization (uncomment if desired)
# start_services

# ============================================
# Project Management
# ============================================

# List all projects
lsp() {
  echo "ðŸ“ Projects in ~/projects:"
  ls -1 ~/projects 2>/dev/null || echo "No projects directory found"
}

# Quick navigation to project
p() {
  if [[ -z "$1" ]]; then
    cd ~/projects
  else
    cd ~/projects/"$1" 2>/dev/null || echo "Project '$1' not found"
  fi
}

# ============================================
# Python Virtual Environment Helper
# ============================================

# Auto-activate venv when entering project directory
auto_activate_venv() {
  if [[ -d ".venv" ]]; then
    if [[ "$VIRTUAL_ENV" != "$(pwd)/.venv" ]]; then
      source .venv/bin/activate 2>/dev/null
    fi
  fi
}

# Uncomment to enable auto-activation when entering directories with .venv
# (Note: This requires additional shell hooks - works better in zsh)
# chpwd() { auto_activate_venv }
